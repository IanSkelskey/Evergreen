<eg-staff-banner bannerText="Item Alert Types" i18n-bannerText>
</eg-staff-banner>
<eg-title i18n-prefix prefix="Item Alert Types Administration">
</eg-title>

<ng-template #eventTemplate let-field="field" let-record="record">
    <select class="form-select" name="{{field.name}}"
        id="{{field.idlClass}}-{{field.name}}"
        [required]="field.isRequired()" [ngModel]="record[field.name]()"
        (ngModelChange)="record['event']($event)">
      <option value="" [selected]="!record[field.name]()" i18n>Any Event</option>
      <option value="CHECKIN" [selected]="record[field.name]() == 'CHECKIN'" i18n>Checkin</option>
      <option value="CHECKOUT" [selected]="record[field.name]() == 'CHECKOUT'" i18n>Checkout</option>
    </select>
</ng-template>

<ng-template #next_statusTemplate let-field="field" let-record="record" let-statuses="statuses">
  <input *ngIf="record.event() !== 'CHECKIN'" class="form-control" id="{{field.idlClass}}-{{field.name}}"
      [value]="record[field.name]()" placeholder="available only for Checkin events" i18n-placeholder readonly />
  <fieldset *ngIf="record.event() === 'CHECKIN'" [attr.aria-label]="field.label" 
      id="next_status-{{record.id()}}" class="scrollable-menu border rounded my-1 p-2 d-sm-flex flex-column flex-wrap">
    <div class="form-check" *ngFor="let status of statuses">
      <input type="checkbox" name="next_status" id="next_status-{{status.id()}}" class="form-check-input"
        [value]="status.id()" [checked]="hasNextStatus(record, status.id())" (change)="recordNextStatus(record, $event)" />
      <label for="next_status-{{status.id()}}" class="form-check-label fw-normal">{{status.name()}}</label>
    </div>
  </fieldset>
</ng-template>

<eg-admin-page #adminPage
  idlClass="ccat"
  [defaultNewRecord]="defaultNewRecord"
  [fieldOptions]="{
    state: {customValues: alertTypeStateEntries},
    event: {customTemplate: {template: eventTemplate}},
    next_status: {customTemplate: {template: next_statusTemplate, context: {statuses: copyStatuses}}}
  }"
  fieldOrder="id,name,active,state,event,scope_org,next_status,in_renew,invert_location"
  orgFieldsDefaultingToContextOrg="scope_org"
  hiddenFields="id"
  readonlyFields="id"
  recordLabel="Item Alert Type" i18n-recordLabel>
</eg-admin-page>
