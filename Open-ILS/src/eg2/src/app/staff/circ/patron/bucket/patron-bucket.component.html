<eg-title i18n-prefix prefix="Patron Buckets">
</eg-title>

<eg-staff-banner bannerText="Patron Buckets" i18n-bannerText>
</eg-staff-banner>

<eg-confirm-dialog #deleteDialog
    dialogTitle="Delete patron bucket?" i18n-dialogTitle
    i18n-dialogBody
    dialogBody="Delete the selected patron bucket(s)?">
</eg-confirm-dialog>

<eg-alert-dialog #retrieveByIdFail
    dialogTitle="Error retrieving bucket" i18n-dialogTitle>
</eg-alert-dialog>

<eg-alert-dialog #deleteFail
    dialogTitle="Error deleting bucket" i18n-dialogTitle
    i18n-dialogBody
    dialogBody="Error deleting one or more buckets">
</eg-alert-dialog>

<div class="container-fluid px-0">
  <div class="row mb-3">
    <div class="col-md-6">
      <ng-container *ngFor="let viewKey of getViewKeys()">
        <button class="btn me-2 mb-2"
            [ngClass]="isCurrentView(viewKey) ? 'btn-success' : 'btn-outline-success'"
            (click)="switchTo(viewKey)">
            {{getViews()[viewKey]?.label}} 
            <span *ngIf="getViews()[viewKey]?.count != null">({{getViews()[viewKey]?.count}})</span>
            <span *ngIf="countInProgress" class="spinner-border spinner-border-sm ms-1" role="status"></span>
        </button>
      </ng-container>
    </div>
    <div class="col-md-6 text-md-end">
      <button class="btn btn-outline-primary me-2 mb-2" (click)="openNewBucketDialog()">
        <span class="material-icons align-text-bottom">add</span>
        <span i18n>New Bucket</span>
      </button>
      <div class="input-group d-inline-flex" style="width: auto;">
        <input type="number" class="form-control" 
          [(ngModel)]="bucketIdToRetrieve" placeholder="Bucket ID" i18n-placeholder>
        <button class="btn btn-outline-primary" (click)="retrieveBucketById()" i18n>Retrieve</button>
      </div>
    </div>
  </div>

  <eg-grid #grid 
      [dataSource]="dataSource"
      [cellTextGenerator]="cellTextGenerator"
      persistKey="circ.patron.bucket.buckets"
      (rowSelectionChange)="gridSelectionChange($event)"
  >
    <eg-grid-column path="id" [index]="true" i18n-label label="ID" visible="true"></eg-grid-column>
    <eg-grid-column path="name" i18n-label label="Name" visible="true"></eg-grid-column>
    <eg-grid-column path="description" i18n-label label="Description" visible="true"></eg-grid-column>
    <eg-grid-column path="btype" i18n-label label="Type" visible="true"></eg-grid-column>
    <eg-grid-column path="owner.usrname" i18n-label label="Owner" visible="true"></eg-grid-column>
    <eg-grid-column path="create_time" i18n-label label="Create Date" visible="true" datatype="timestamp"></eg-grid-column>
  </eg-grid>
</div>

<ng-template #actionsTemplate let-bucket="row">
  <button class="btn btn-sm btn-outline-primary" 
    [disabled]="!bucket?.id" 
    (click)="jumpToBucketContent(bucket?.id)" i18n>
    <span class="material-icons">visibility</span>
    View Content
  </button>
</ng-template>

<eg-bucket-dialog #newBucketDialog></eg-bucket-dialog>
